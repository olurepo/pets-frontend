"use strict";(self.webpackChunktransformer_viz=self.webpackChunktransformer_viz||[]).push([[667],{8667:(e,n,t)=>{t.r(n),t.d(n,{AttentionMapContainer:()=>H,default:()=>L});var r,i,a=t(5893),o=t(7294),l=t(6974),s=t(2734),u=t(8025),c=t(7666),d=t(7298),f=t(2927),h=t(2580),p=t(1508),x=t(461),y=t(2658),v=t(4524),j=t(9669),m=t.n(j),g=t(9062),w=t(4519),b=t(4702),Z=function(){return Z=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},Z.apply(this,arguments)},k=function(e,n,t){if(t||2===arguments.length)for(var r,i=0,a=n.length;i<a;i++)!r&&i in n||(r||(r=Array.prototype.slice.call(n,0,i)),r[i]=n[i]);return e.concat(r||Array.prototype.slice.call(n))},P=40,A="black";v.Z.div(O||(r=["\n    width: 70%;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n    margin-bottom: 20px;\n"],i=["\n    width: 70%;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n    margin-bottom: 20px;\n"],Object.defineProperty?Object.defineProperty(r,"raw",{value:i}):r.raw=i,O=r));const S=function(e){var n=e.layer,t=e.head,r=e.id,i=e.model,l=(0,o.useState)([]),s=l[0],u=l[1],c=(0,o.useState)([]),d=c[0],f=c[1],h=(0,o.useState)([]),p=h[0],x=h[1],y=(0,o.useState)([]),v=y[0],j=y[1],S=(0,o.useState)(!1),O=S[0],F=S[1],T=(0,o.useState)(!1),C=T[0],I=T[1];return(0,o.useEffect)((function(){!function(){var e,a,o,l;e=this,a=void 0,l=function(){var e,a;return function(e,n){var t,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(a){return function(l){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=n.call(e,o)}catch(e){a=[6,e],r=0}finally{t=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(o){switch(o.label){case 0:e="".concat(b.z0,"/attention-score?layerNumber=").concat(n,"&headNumber=").concat(t,"&instance=").concat(r,"&model=").concat(i),o.label=1;case 1:return o.trys.push([1,3,,4]),F(!0),[4,m()(e)];case 2:if(""===(a=o.sent()).data)throw new Error("Empty response");return f(a.data.from),x(a.data.to),j(a.data.links),[3,4];case 3:return o.sent(),F(!1),I(!0),[3,4];case 4:return[2]}}))},new((o=void 0)||(o=Promise))((function(n,t){function r(e){try{s(l.next(e))}catch(e){t(e)}}function i(e){try{s(l.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,i)}s((l=l.apply(e,a||[])).next())}))}()}),[t,r,n,i]),(0,o.useEffect)((function(){d.length>0&&F(!1)}),[d]),(0,a.jsxs)(a.Fragment,{children:[!O&&C&&(0,a.jsx)("p",{children:"Failed to load attention map"}),O&&!C&&(0,a.jsx)(g.Z,{}),!O&&!C&&(0,a.jsxs)(w.Z,Z({dimensions:{width:600,height:50*d.length,margin:{top:20,bottom:20,left:20,right:20}}},{children:[d.map((function(e){return(0,a.jsxs)("g",{children:[(0,a.jsx)("rect",{width:150,height:P,fill:"white",stroke:A,x:10,y:e.id*P,onMouseEnter:function(){return n=e.id,j((function(e){return e.map((function(e){return e.from!==n?Z(Z({},e),{visible:!1}):e}))})),void u((function(){return v.reduce((function(e,t){return t.from===n?k(k([],e,!0),[{toTokenId:t.to,value:t.weight}],!1):e}),[])}));var n},onMouseLeave:function(){return j((function(e){return e.map((function(e){return Z(Z({},e),{visible:!0})}))})),void u([])}}),(0,a.jsx)("text",Z({x:20,y:e.id*P+P/1.5},{children:e.word}))]})})),p.map((function(e){return(0,a.jsxs)("g",{children:[(0,a.jsx)("text",Z({x:310,y:e.id*P+P/1.5},{children:e.word})),(0,a.jsx)("rect",{width:150,height:P,fill:"none",stroke:A,x:300,y:e.id*P})]})})),s.length>0&&s.map((function(e){return(0,a.jsxs)("g",{children:[(0,a.jsx)("rect",{width:50,height:P,fill:"grey",stroke:A,x:450,y:e.toTokenId*P}),(0,a.jsx)("text",Z({x:460,y:e.toTokenId*P+P/1.5},{children:e.value}))]})})),v.map((function(e){return e.visible&&(0,a.jsx)("line",{x1:160,x2:300,y1:e.from*P+20,y2:e.to*P+20,stroke:"cornflowerblue",strokeWidth:e.weight})}))]}))]})};var O,F=function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},T=function(){return T=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},T.apply(this,arguments)},C=v.Z.div(z||(z=F(["\n    width: 70%;\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    margin-bottom: 20px;\n"],["\n    width: 70%;\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    margin-bottom: 20px;\n"]))),I=v.Z.div(N||(N=F(["\n    width: 70%;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n"],["\n    width: 70%;\n    display: flex;\n    flex-direction: row;\n    justify-content: space-around;\n"]))),M=["Pre-trained","Fine-tuned","Pre-trained Adversarial","Fine-tuned Adversarial"],W={PaperProps:{style:{maxHeight:224,width:250}}};function E(e,n,t){return{fontWeight:-1===n.indexOf(e)?t.typography.fontWeightRegular:t.typography.fontWeightMedium}}var H=function(){var e,n,t,r=(0,l.UO)().id,i=(t=(0,l.TH)().search,o.useMemo((function(){return new URLSearchParams(t)}),[t])),v=(0,s.Z)(),j=(0,o.useState)(null!==(e=i.get("layer"))&&void 0!==e?e:1),m=j[0],g=j[1],w=(0,o.useState)(null!==(n=i.get("head"))&&void 0!==n?n:1),b=w[0],Z=w[1],k=o.useState(["Pre-trained"]),P=k[0],A=k[1],O=function(){var e=parseInt(null!=r?r:"0",10);return e%2==0?e+1:e-1};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(C,{children:[(0,a.jsxs)(u.Z,T({variant:"filled",sx:{m:1,minWidth:300}},{children:[(0,a.jsx)(c.Z,T({id:"layer-input"},{children:"Layer"})),(0,a.jsx)(d.Z,T({labelId:"layer-input",value:m,label:"Layer",onChange:function(e){g(e.target.value)}},{children:Array.from(Array(12).keys()).map((function(e){return(0,a.jsx)(f.Z,T({value:e},{children:e}))}))}))]})),(0,a.jsxs)(u.Z,T({variant:"filled",sx:{m:1,minWidth:300}},{children:[(0,a.jsx)(c.Z,T({id:"head-input"},{children:"Head"})),(0,a.jsx)(d.Z,T({labelId:"head-input",value:b,label:"Head",onChange:function(e){Z(e.target.value)}},{children:Array.from(Array(12).keys()).map((function(e){return(0,a.jsx)(f.Z,T({value:e},{children:e}))}))}))]})),(0,a.jsxs)(u.Z,T({sx:{m:1,width:300}},{children:[(0,a.jsx)(c.Z,T({id:"map-variations"},{children:"Map Variations"})),(0,a.jsx)(d.Z,T({labelId:"map-variations",multiple:!0,value:P,onChange:function(e){var n=e.target.value,t="string"==typeof n?n.split(","):n;t.length<=2&&A(t)},input:(0,a.jsx)(h.Z,{id:"select-multiple-chip",label:"Chip"}),renderValue:function(e){return(0,a.jsx)(p.Z,T({sx:{display:"flex",flexWrap:"wrap",gap:.5}},{children:e.map((function(e){return(0,a.jsx)(x.Z,{label:e},e)}))}))},MenuProps:W},{children:M.map((function(e){return(0,a.jsx)(f.Z,T({value:e,style:E(e,P,v)},{children:e}),e)}))}))]}))]}),(0,a.jsxs)(I,{children:[P.includes("Pre-trained")&&(0,a.jsxs)("div",{children:[(0,a.jsx)(y.Z,{children:"Pre-Trained Attentions"}),(0,a.jsx)(S,{layer:m,head:b,id:null!=r?r:"1",model:"pretrained"})]}),P.includes("Fine-tuned")&&(0,a.jsxs)("div",{children:[(0,a.jsx)(y.Z,{children:"Fine-tuned Attentions"}),(0,a.jsx)(S,{layer:m,head:b,id:null!=r?r:"1",model:"fineTuned"})]}),P.includes("Pre-trained Adversarial")&&(0,a.jsxs)("div",{children:[(0,a.jsx)(y.Z,{children:"Pre-trained Adversarial Pair"}),(0,a.jsx)(S,{layer:m,head:b,id:O().toString(),model:"pretrained"})]}),P.includes("Fine-tuned Adversarial")&&(0,a.jsxs)("div",{children:[(0,a.jsx)(y.Z,{children:"Fine-tuned Adversarial Pair"}),(0,a.jsx)(S,{layer:m,head:b,id:O().toString(),model:"fineTuned"})]})]})]})};const L=H;var z,N}}]);
//# sourceMappingURL=667.bundle.js.map